<div id="page-wrapper">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <h2 class="page-header text-center"><i class="fa fa-hashtag"></i> Manage Serps</h2>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover table-striped">
                            <thead>
                                <tr>
                                	<th>S. No.</th>
                                    <th>Keyword</th>
                                    <th>Domain</th>
                                    <th>Status</th>
                                    <th>Old</th>
                                    <td>New</td>
                                    <td>Change</td>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                            	{script $i = 1}
                                {foreach $serp in $serps}
                                <tr>
                                	<td>{echo $i}</td>
                                    <td>{echo $serp->keyword}</td>
                                    {script $website = Website::first(array("id = ?" => $serp->website_id), array("url"))}
                                    <td>{echo $website->url}</td>
                                    <td>
                                        {if $serp->live}
                                        <span class="label label-success">Active</span>
                                        {/if} {else}
                                        <span class="label label-danger">Disabled by admin</span>
                                        {/else}
                                    </td>
                                    {script $date_today = date("Y-m-d")}
                                    
                                    {script $old_date = date("Y-m-d", strtotime($date_today."-7 day"))}
                                    {script $old_rank = Rank::first(array("keyword_id = ?" => $serp->id, "created = ?" => $old_date), array("position"))}
                                    <td>{echo $old_rank->position}</td>

                                    {script $new_rank = Rank::first(array("keyword_id = ?" => $serp->id, "created = ?" => $date_today), array("position"))}
                                    <td>{echo $new_rank->position}</td>

                                    {script $change = (int) $new_rank->position - (int) $old_rank->position}
                                    <td class="{if $change > 0}text-green{/if}{elseif $change < 0}text-red{/elseif}">$change</td>
                                    <td>
                                        <a href="/serp/stats/{echo $serp->id}" class="btn btn-primary btn-xs"><i class="fa fa-label"></i> View Stats</a>
                                        <a href="/serp/remove/{echo $serp->id}/{echo $action->id}" class="btn btn-danger delete btn-xs"><i class="fa fa-trash"></i> Delete</a>
                                    </td>
                                </tr>
                                {script ++$i}
                                {/foreach}
                            </tbody>
                        </table>
                    </div>
                </div>
                <a href="/serp/create/{echo $website->id}" class="btn btn-primary"><i class="fa fa-plus"></i> Add Another Serp</a>
            </div>
        </div>

    </div>
</div>
